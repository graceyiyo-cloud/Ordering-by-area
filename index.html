<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨‚å–®é‡‘é¡çµ±è¨ˆåŠ©æ‰‹ - è‡ªå‹•åˆ†çµ„ç‰ˆ</title>
    <style>
        /* --- 1. è®Šæ•¸èˆ‡åŸºç¤è¨­å®š --- */
        :root {
            --primary-pink: #ff85a2;
            --hover-pink: #ff6b8e;
            --light-pink: #ffb3c6;
            --bg-pink: #fdfafb;
            --text-brown: #5d4037;
            --accent-pink: #fce4ec;
            --border-pink: #f8e1e7;
            --white: #ffffff;
        }

        body { 
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; 
            max-width: 540px; 
            margin: 20px auto; 
            padding: 15px; 
            line-height: 1.6; 
            background-color: var(--bg-pink); 
            color: var(--text-brown); 
        }

        /* --- 2. å®¹å™¨èˆ‡å€å¡Š --- */
        .container { 
            background: var(--white); 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(255, 133, 162, 0.15); 
        }

        h2 { 
            text-align: center; 
            margin-top: 0; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
            color: var(--primary-pink); 
            font-size: 22px; 
        }

        .hint { 
            color: #8d6e63; 
            font-size: 13px; 
            margin-bottom: 15px; 
            text-align: center; 
            background: #fff5f7; 
            padding: 10px; 
            border-radius: 12px; 
            border: 1px solid #ffdde1; 
        }

        /* --- 3. è¼¸å…¥æ§åˆ¶é … --- */
        textarea { 
            width: 100%; 
            height: 200px; 
            padding: 15px; 
            border: 2px solid var(--border-pink); 
            border-radius: 15px; 
            font-size: 15px; 
            margin-bottom: 15px; 
            box-sizing: border-box; 
            resize: vertical; 
            transition: all 0.3s; 
            background-color: #fffafb; 
        }

        textarea:focus { 
            outline: none; 
            border-color: var(--primary-pink); 
            background-color: var(--white); 
            box-shadow: 0 0 8px rgba(255, 133, 162, 0.2); 
        }

        /* --- 4. æŒ‰éˆ•æ¨£å¼ --- */
        .btn-group { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        
        button { 
            flex: 1; 
            min-width: 100px; 
            padding: 12px 8px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: bold; 
            transition: all 0.2s; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 5px; 
        }
        
        button:hover { transform: translateY(-2px); }

        .process-btn { background-color: var(--primary-pink); color: var(--white); }
        .process-btn:hover { background-color: var(--hover-pink); box-shadow: 0 5px 15px rgba(255, 133, 162, 0.3); }
        
        .copy-btn { background-color: var(--light-pink); color: var(--white); }
        .copy-btn:hover { background-color: #ffa39e; box-shadow: 0 5px 15px rgba(255, 183, 178, 0.3); }
        
        .clear-btn { background-color: var(--accent-pink); color: #d81b60; border: 1px solid #f8bbd0; }
        .clear-btn:hover { background-color: #f8bbd0; }

        /* --- 5. çµæœé¡¯ç¤ºå€ --- */
        #resultArea { margin-top: 25px; display: none; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(15px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        .group-section { 
            margin-bottom: 25px; 
            border: 2px solid #fff0f3; 
            border-radius: 16px; 
            overflow: hidden; 
            background: var(--white); 
            box-shadow: 0 4px 10px rgba(0,0,0,0.02); 
        }

        .group-header { 
            background: #fff0f3; 
            padding: 10px 15px; 
            font-weight: bold; 
            border-bottom: 1px solid #ffe1e9; 
            display: flex; 
            justify-content: space-between; 
            color: #ff5c8d; 
            font-size: 15px; 
        }

        table { width: 100%; border-collapse: collapse; }
        th { background-color: #fffafb; color: #a1887f; font-weight: 600; padding: 10px; border-bottom: 1px solid #fff0f3; font-size: 13px; }
        td { padding: 10px; border-bottom: 1px solid #fffafa; font-size: 14px; color: var(--text-brown); }
        
        .item-col { text-align: left; padding-left: 20px; } 
        .qty-col { width: 60px; text-align: center; }

        /* --- 6. æœ€çµ‚çµ±è¨ˆå¡ç‰‡ --- */
        .summary-card { 
            background: var(--light-pink); 
            color: var(--white); 
            padding: 20px; 
            border-radius: 20px; 
            margin-top: 25px; 
            box-shadow: 0 10px 25px rgba(255, 179, 198, 0.2);
            border: 3px solid var(--white);
        }

        .summary-title { 
            font-size: 17px; 
            margin-bottom: 12px; 
            border-bottom: 2px dashed rgba(255,255,255,0.6); 
            padding-bottom: 8px; 
            font-weight: bold; 
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            color: #c2185b; 
        }

        .summary-row { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 6px; 
            font-size: 15px; 
            font-weight: bold; 
            color: var(--text-brown); 
        }

        .summary-item-name { text-align: left; flex: 1; }
        
        .grand-total-qty { 
            font-size: 18px; 
            margin-top: 12px; 
            border-top: 2px dashed rgba(255,255,255,0.6); 
            padding-top: 8px;
        }

        .grand-total { 
            font-size: 30px; 
            color: #d81b60; 
            font-weight: 900; 
            margin-top: 5px; 
            text-shadow: 1px 1px 0px rgba(255,255,255,0.5);
        }

        /* --- 7. å…¶ä»– --- */
        .toast { 
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); 
            background: rgba(0,0,0,0.7); color: var(--white); 
            padding: 8px 20px; border-radius: 25px; 
            display: none; z-index: 1000; font-weight: bold; font-size: 14px; 
        }
    </style>
</head>
<body>

<div class="container">
    <h2>è¨‚å–®åˆ†çµ„çµ±è¨ˆåŠ©æ‰‹</h2>
    <div class="hint">
        ğŸ€ æ”¯æ´æ ¼å¼ï¼š<b>éƒ¨é–€-é¤é»åç¨± åƒ¹æ ¼</b><br>
        (ç¨‹å¼æœƒè‡ªå‹•æŠ“å–æ©«ç·šå‰æ–¹çš„æ–‡å­—ä½œç‚ºåˆ†çµ„ä¾æ“š)
    </div>
    
    <textarea id="inputData" placeholder="è«‹è²¼ä¸Šè¨‚å–®è³‡æ–™ï¼Œä¾‹å¦‚ï¼š

ç¸½ç®¡è™•- èƒ¡æ¤’æµ·é¹½å°ç£é¯›æ³°å¼è¾£é›é†¬ 115
ç¸½ç®¡è™•- èœ‚èœœç…§ç‡’é›è…¿èœ‚èœœèŠ¥æœ«é†¬ 115
åŒ—å®‰- å¢¨è¥¿å“¥å«©é›èƒ¸æ³°å¼è¾£é›é†¬ 100
æˆå¤§- æ³°å¼æ‰“æ‹‹è±¬é¦™é†‡èƒ¡éº»é†¬ 115
ç¸½ç®¡è™•- èƒ¡æ¤’æµ·é¹½é›èƒ¸é¦™é†‡èƒ¡éº»é†¬åŠé£¯ 100"></textarea>
    
    <div class="btn-group">
        <button class="process-btn" onclick="handleProcess()">âœ¨ é–‹å§‹çµ±è¨ˆ</button>
        <button class="copy-btn" onclick="handleCopy()">â­ è¤‡è£½æ–‡å­—</button>
        <button class="clear-btn" onclick="handleClear()">ğŸ—‘ï¸ æ¸…é™¤</button>
    </div>

    <div id="resultArea">
        <div id="groupsContainer"></div>

        <div class="summary-card">
            <div class="summary-title">å…¨éƒ¨æœ€çµ‚çµ±è¨ˆ</div>
            <div id="overallStats"></div>
            
            <div class="summary-row grand-total-qty">
                <span>ç¸½ä»½æ•¸ï¼š</span>
                <span id="totalQty">0 ä»½</span>
            </div>
            <div class="summary-row grand-total">
                <span>ç¸½é‡‘é¡ï¼š</span>
                <span id="totalAmount">$0</span>
            </div>
        </div>
    </div>
</div>

<div id="toast" class="toast"></div>

<script>
    /* --- å¸¸æ•¸èˆ‡è¨­å®š --- */
    // ç”¨æ–¼è‡ªå‹•åœ¨å£å‘³æˆ–é¸é …å‰åŠ ç©ºç™½ï¼Œæ–¹ä¾¿é–±è®€
    const KEYWORDS_TO_SPACE = /(ç„¡ç³–|å¾®ç³–|ä¸€åˆ†ç³–|äºŒåˆ†ç³–|ä¸‰åˆ†ç³–|åŠç³–|å°‘ç³–|ä¸ƒåˆ†ç³–|å»å†°|å¾®å†°|å°‘å†°|å¤šå†°|æ­£å¸¸|ç†±|åŠé£¯|é£¯å°‘|é£¯å¤š)/g;

    /* --- é€šç”¨å·¥å…·å‡½æ•¸ --- */
    const formatNum = (num) => num.toLocaleString();
    const chineseSort = (a, b) => a.localeCompare(b, 'zh-Hant');
    
    const showToast = (msg) => {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.style.display = 'block';
        setTimeout(() => { t.style.display = 'none'; }, 2000);
    };

    /* --- è³‡æ–™è™•ç†é‚è¼¯ (æ ¸å¿ƒä¿®æ”¹è™•) --- */
    function parseOrderData(input) {
        const lines = input.split('\n');
        const groups = {}; // çµæ§‹: { 'ç¸½ç®¡è™•': { items: { 'é¤é»A': {qty, price} }, subQty, subAmount } }
        let stats = { totalQty: 0, totalAmount: 0 };

        lines.forEach(line => {
            const trimmed = line.trim();
            if (!trimmed) return;

            // å°‹æ‰¾ç¬¬ä¸€å€‹æ©«ç·šçš„ä½ç½®
            const hyphenIndex = trimmed.indexOf('-');
            
            // å¦‚æœé€™è¡Œæ²’æœ‰æ©«ç·šï¼Œæˆ–æ©«ç·šåœ¨é–‹é ­/çµå°¾ï¼Œè¦–ç‚ºç„¡æ•ˆæˆ–ç„¡æ³•åˆ†çµ„
            if (hyphenIndex <= 0 || hyphenIndex >= trimmed.length - 1) return;

            // 1. æŠ“å–åˆ†çµ„åç¨± (æ©«ç·šå‰é¢)
            const groupName = trimmed.substring(0, hyphenIndex).trim();

            // 2. æŠ“å–å…§å®¹ (æ©«ç·šå¾Œé¢)
            const content = trimmed.substring(hyphenIndex + 1).trim();

            // 3. è§£æå…§å®¹ä¸­çš„ é¤é» èˆ‡ åƒ¹æ ¼
            // Regex: æŠ“å–å‰é¢çš„æ–‡å­—(éè²ªå©ª) èˆ‡ æœ€å¾Œé¢çš„æ•¸å­—
            const match = content.match(/^(.*?)(\d+)$/);

            if (match) {
                let itemName = match[1].trim();
                const price = parseInt(match[2], 10);

                // æ ¼å¼åŒ–é—œéµå­—é–“éš” (å„ªåŒ–é¡¯ç¤º)
                itemName = itemName.replace(/([^\s])/ + KEYWORDS_TO_SPACE.source, '$1 $2').replace(/\s+/g, ' ');

                // åˆå§‹åŒ–ç¾¤çµ„ (å¦‚æœè©²ç¾¤çµ„é‚„æ²’å‡ºç¾é)
                if (!groups[groupName]) {
                    groups[groupName] = { items: {}, subQty: 0, subAmount: 0 };
                }

                // ç´€éŒ„å“é …
                const group = groups[groupName];
                if (!group.items[itemName]) {
                    group.items[itemName] = { qty: 0, price: price };
                }
                
                // ç´¯åŠ æ•¸æ“š
                group.items[itemName].qty += 1;
                group.subQty += 1;
                group.subAmount += price;

                stats.totalQty += 1;
                stats.totalAmount += price;
            }
        });

        return { groups, stats };
    }

    /* --- ç•«é¢æ¸²æŸ“é‚è¼¯ --- */
    function renderResults(data) {
        const { groups, stats } = data;
        const container = document.getElementById('groupsContainer');
        container.innerHTML = "";
        
        // ä¾ç…§ç¾¤çµ„åç¨±æ’åº (ä¸­æ–‡æ’åº)
        const sortedGroups = Object.keys(groups).sort(chineseSort);

        sortedGroups.forEach(gName => {
            const group = groups[gName];
            if (group.subQty === 0) return;

            const sortedItems = Object.keys(group.items).sort(chineseSort);
            let rowsHtml = sortedItems.map(iName => `
                <tr>
                    <td class="item-col">${iName}</td>
                    <td class="qty-col">${formatNum(group.items[iName].qty)}</td>
                </tr>
            `).join('');

            container.innerHTML += `
                <div class="group-section">
                    <div class="group-header">
                        <span>â­ ${gName}</span>
                        <span>å…± ${formatNum(group.subQty)} ä»½</span>
                    </div>
                    <table>
                        <thead><tr><th class="item-col">å“é …èˆ‡å‚™è¨»</th><th class="qty-col">æ•¸é‡</th></tr></thead>
                        <tbody>${rowsHtml}</tbody>
                    </table>
                    <div style="text-align:right; padding: 10px 15px; font-weight:bold; background: #fffcfd; color: #ff6b8e; font-size: 14px;">
                        å°è¨ˆï¼š$${formatNum(group.subAmount)}
                    </div>
                </div>`;
        });

        // ç¸½è¨ˆæ‘˜è¦
        const overallMap = {};
        Object.values(groups).forEach(g => {
            Object.entries(g.items).forEach(([name, info]) => {
                overallMap[name] = (overallMap[name] || 0) + info.qty;
            });
        });

        const overallHtml = Object.keys(overallMap).sort(chineseSort).map(name => `
            <div class="summary-row">
                <span class="summary-item-name">${name}</span>
                <span>${formatNum(overallMap[name])} ä»½</span>
            </div>
        `).join('');

        document.getElementById('overallStats').innerHTML = overallHtml;
        document.getElementById('totalQty').innerText = `${formatNum(stats.totalQty)} ä»½`;
        document.getElementById('totalAmount').innerText = `$${formatNum(stats.totalAmount)}`;
        document.getElementById('resultArea').style.display = 'block';
    }

    /* --- äº‹ä»¶è™•ç† --- */
    function handleProcess() {
        const input = document.getElementById('inputData').value.trim();
        if (!input) return showToast("è«‹è¼¸å…¥è¨‚å–®å…§å®¹å…§å®¹å”· â­");

        const data = parseOrderData(input);
        if (data.stats.totalQty === 0) return showToast("ç„¡æ³•è§£æè³‡æ–™ï¼Œè«‹æª¢æŸ¥æ ¼å¼å”· â­");

        renderResults(data);
        // å¹³æ»‘æ²å‹•åˆ°çµæœå€
        setTimeout(() => {
             window.scrollTo({ top: document.getElementById('resultArea').offsetTop - 20, behavior: 'smooth' });
        }, 100);
    }

    function handleClear() {
        document.getElementById('inputData').value = "";
        document.getElementById('resultArea').style.display = 'none';
        document.getElementById('groupsContainer').innerHTML = "";
        showToast("å…§å®¹å·²æ¸…ç©º âœ¨");
    }

    function handleCopy() {
        const area = document.getElementById('resultArea');
        if (area.style.display === 'none') return;

        let text = "ã€è¨‚å–®åŒ¯ç¸½çµ±è¨ˆçµæœã€‘\n\n";
        document.querySelectorAll('.group-section').forEach(sec => {
            text += `${sec.querySelector('.group-header').innerText}\n`;
            sec.querySelectorAll('tbody tr').forEach(row => {
                const td = row.querySelectorAll('td');
                text += `- ${td[0].innerText} * ${td[1].innerText}\n`;
            });
            text += `${sec.querySelector('div[style*="text-align:right"]').innerText}\n\n`;
        });

        text += "--------------------\nã€å…¨éƒ¨ç¸½è¨ˆæ‘˜è¦ã€‘\n";
        document.querySelectorAll('#overallStats .summary-row').forEach(row => {
            text += `${row.children[0].innerText}ï¼š${row.children[1].innerText}\n`;
        });
        text += `\nç¸½ä»½æ•¸ï¼š${document.getElementById('totalQty').innerText}\n`;
        text += `ç¸½é‡‘é¡ï¼š${document.getElementById('totalAmount').innerText}`;

        const temp = document.createElement('textarea');
        temp.value = text;
        document.body.appendChild(temp);
        temp.select();
        document.execCommand('copy');
        document.body.removeChild(temp);
        showToast("å·²è¤‡è£½å®Œæ•´çµ±è¨ˆå ±è¡¨ï¼ âœ¨");
    }
</script>

</body>
</html>